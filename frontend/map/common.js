const WalkMetersPerMinute = 1.0 * 60;

function loadJson(url) {
    return new Promise((resolve, reject) => {
        let req = new XMLHttpRequest();
        req.addEventListener("load", function() {
            try
            {
                var res = JSON.parse(req.responseText);
            }
            catch (e)
            {
                return reject("Invalid JSON");
            }
            resolve(res);
        });
        req.onerror = () => reject(req.statusText);
        req.open("GET", url);
        req.send();
    });
}

let allRoutes = null;

function loadRoutes()
{
    if (allRoutes)
    {
        return Promise.resolve(allRoutes);
    }
    else
    {
        return loadJson("/api/routes?v4").then(function(routes) {
            allRoutes = routes;
            return routes;
        });
    }
}

let routesMap = null;

function loadRoute(routeId)
{
    if (routesMap)
    {
        return Promise.resolve(routesMap[routeId]);
    }
    else
    {
        return loadRoutes().then(function(routes) {
            routesMap = {};
            for (const route of routes) {
                routesMap[route.id] = route;
            }
            return routesMap[routeId];
        });
    }
}

const ServiceArea = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -122.47352600097655,
              37.809919574015545
            ],
            [
              -122.47833251953122,
              37.809919574015545
            ],
            [
              -122.48691558837888,
              37.790116270812824
            ],
            [
              -122.50099182128905,
              37.789302322860244
            ],
            [
              -122.50923156738278,
              37.78821704497659
            ],
            [
              -122.51678466796874,
              37.78034830365157
            ],
            [
              -122.50751495361327,
              37.72089869333032
            ],
            [
              -122.49961853027342,
              37.68952589794135
            ],
            [
              -122.38941192626953,
              37.69061262365255
            ],
            [
              -122.39078521728513,
              37.706775788247036
            ],
            [
              -122.37155914306639,
              37.70813387686182
            ],
            [
              -122.37808227539061,
              37.71112158421217
            ],
            [
              -122.37052917480466,
              37.71845453701034
            ],
            [
              -122.361946105957,
              37.71519553647589
            ],
            [
              -122.3557662963867,
              37.72035555445047
            ],
            [
              -122.35542297363281,
              37.73013144497153
            ],
            [
              -122.36778259277341,
              37.7342043518508
            ],
            [
              -122.36469268798828,
              37.73963454585709
            ],
            [
              -122.37258911132812,
              37.74750761967557
            ],
            [
              -122.37361907958983,
              37.75239393391763
            ],
            [
              -122.37945556640624,
              37.75402263362959
            ],
            [
              -122.38254547119139,
              37.789031004883626
            ],
            [
              -122.39936828613278,
              37.80802085728357
            ],
            [
              -122.4100112915039,
              37.81181824192454
            ],
            [
              -122.42031097412108,
              37.81208947621166
            ],
            [
              -122.46356964111327,
              37.805850835522016
            ],
            [
              -122.47352600097655,
              37.809919574015545
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -122.37396240234375,
              37.80842772926478
            ],
            [
              -122.3609161376953,
              37.8065289741725
            ],
            [
              -122.35954284667967,
              37.80815648152641
            ],
            [
              -122.35954284667967,
              37.815751041563544
            ],
            [
              -122.36846923828125,
              37.814123701604466
            ],
            [
              -122.36846923828125,
              37.815751041563544
            ],
            [
              -122.36022949218749,
              37.82009043941308
            ],
            [
              -122.36778259277344,
              37.83148014503288
            ],
            [
              -122.37361907958984,
              37.832835945274034
            ],
            [
              -122.37911224365234,
              37.830666652929224
            ],
            [
              -122.38048553466797,
              37.82795494780686
            ],
            [
              -122.37224578857423,
              37.815751041563544
            ],
            [
              -122.37396240234375,
              37.80842772926478
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -122.47592926025389,
              37.842190287869684
            ],
            [
              -122.55249023437501,
              37.84042796619093
            ],
            [
              -122.55111694335939,
              37.83337825839438
            ],
            [
              -122.54081726074219,
              37.83148014503288
            ],
            [
              -122.53669738769533,
              37.82632787689904
            ],
            [
              -122.53841400146483,
              37.82415839321614
            ],
            [
              -122.52880096435548,
              37.81385247479046
            ],
            [
              -122.52742767333983,
              37.819276821747295
            ],
            [
              -122.52296447753906,
              37.824700770115996
            ],
            [
              -122.51506805419922,
              37.824700770115996
            ],
            [
              -122.49961853027342,
              37.81873440498779
            ],
            [
              -122.49069213867188,
              37.82632787689904
            ],
            [
              -122.48073577880858,
              37.82551432799189
            ],
            [
              -122.47180938720703,
              37.83120898199489
            ],
            [
              -122.47112274169922,
              37.83825889708791
            ],
            [
              -122.47592926025389,
              37.842190287869684
            ]
          ]
        ]
      }
    }
  ]
};
